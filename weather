<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å³æ™‚å¤©æ°£æŸ¥è©¢ - æœƒç¨½å€</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: background 1s ease;
  color: #fff;
  background: linear-gradient(to bottom,#0f2027,#203a43,#2c5364);
}
#weather-card {
  background: rgba(0,0,0,0.6);
  padding: 25px 20px;
  border-radius: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.7);
  max-width: 500px;
  width: 95%;
  text-align: center;
}
h1 { 
  font-size:22px; 
  margin-bottom:15px; 
  color:#00f0ff; 
  text-shadow:2px 2px 8px rgba(0,0,0,0.6);
}
#weather { 
  font-size:16px; 
  line-height:1.6; 
  margin-bottom:10px;
  transition: opacity 0.5s ease;
}
#timeText {
  font-family: monospace;
  font-size:16px;
  margin-top:15px;
  color:#ffea00;
  text-align: center;
}
select, button {
  padding:5px 10px;
  border-radius:5px;
  border:none;
  margin-bottom:10px;
  width:80%;
  font-size:16px;
  cursor:pointer;
}
button {
  background-color:#00aaff;
  color:#fff;
}
button:hover {
  background-color:#0088cc;
}
#hourly-weather {
  display: flex;
  overflow-x: auto;
  gap: 10px;
  margin-top:15px;
  background: rgba(255,255,255,0.1);
  border-radius: 10px;
  padding:10px;
}
.hour-cell {
  flex: 0 0 60px;
  display:flex;
  flex-direction: column;
  align-items: center;
  font-size:14px;
}
.hour-cell .icon {
  font-size:24px;
  margin:5px 0;
}
#daily-temp {
  margin-top:10px;
  font-size:16px;
}
</style>
</head>
<body>
<div id="weather-card">
  <h1>æ¡ƒåœ’å¸‚æ¡ƒåœ’å€æœƒç¨½åœ°å€</h1>
  <select id="citySelect" onchange="changeCity()">
    <option value="æœé™½é‡Œ">æœé™½é‡Œ</option>
    <option value="é’æºªé‡Œ">é’æºªé‡Œ</option>
    <option value="æˆåŠŸé‡Œ">æˆåŠŸé‡Œ</option>
    <option value="ä¸‰æ°‘é‡Œ">ä¸‰æ°‘é‡Œ</option>
    <option value="å¿ ç¾©é‡Œ">å¿ ç¾©é‡Œ</option>
    <option value="ç¦å…ƒé‡Œ">ç¦å…ƒé‡Œ</option>
    <option value="ä¸‰å…ƒé‡Œ">ä¸‰å…ƒé‡Œ</option>
    <option value="å¤§èˆˆé‡Œ">å¤§èˆˆé‡Œ</option>
    <option value="æœƒç¨½é‡Œ">æœƒç¨½é‡Œ</option>
    <option value="æªœæ¨‚é‡Œ">æªœæ¨‚é‡Œ</option>
    <option value="å¤§æ¥­é‡Œ">å¤§æ¥­é‡Œ</option>
    <option value="å¤§æœ‰é‡Œ">å¤§æœ‰é‡Œ</option>
    <option value="å¯¶å±±é‡Œ">å¯¶å±±é‡Œ</option>
    <option value="å¯¶æ°‘é‡Œ">å¯¶æ°‘é‡Œ</option>
    <option value="æ˜¥æ—¥é‡Œ">æ˜¥æ—¥é‡Œ</option>
    <option value="æ±´æ´²é‡Œ">æ±´æ´²é‡Œ</option>
    <option value="æ±é–€é‡Œ">æ±é–€é‡Œ</option>
    <option value="æ±å±±é‡Œ">æ±å±±é‡Œ</option>
    <option value="è¬å£½é‡Œ">è¬å£½é‡Œ</option>
  </select>
  <br>
  <button onclick="randomCity()">éš¨æ©Ÿé¸ä¸€å€‹é‡Œ</button>

  <div id="weather">è®€å–ä¸­...</div>
  <div id="hourly-weather"></div>
  <div id="daily-temp"></div>
  <div id="timeText">æ™‚é–“è¼‰å…¥ä¸­...</div>
</div>

<script>
let currentCity="æœé™½é‡Œ";
const cityCoords={
  "æœé™½é‡Œ":{lat:24.9970,lon:121.3020},
  "é’æºªé‡Œ":{lat:24.9980,lon:121.3040},
  "æˆåŠŸé‡Œ":{lat:24.9990,lon:121.3060},
  "ä¸‰æ°‘é‡Œ":{lat:25.0000,lon:121.3080},
  "å¿ ç¾©é‡Œ":{lat:25.0010,lon:121.3100},
  "ç¦å…ƒé‡Œ":{lat:25.0020,lon:121.3120},
  "ä¸‰å…ƒé‡Œ":{lat:25.0030,lon:121.3140},
  "å¤§èˆˆé‡Œ":{lat:25.0040,lon:121.3160},
  "æœƒç¨½é‡Œ":{lat:25.0050,lon:121.3180},
  "æªœæ¨‚é‡Œ":{lat:25.0060,lon:121.3200},
  "å¤§æ¥­é‡Œ":{lat:25.0070,lon:121.3220},
  "å¤§æœ‰é‡Œ":{lat:25.0080,lon:121.3240},
  "å¯¶å±±é‡Œ":{lat:25.0090,lon:121.3260},
  "å¯¶æ°‘é‡Œ":{lat:25.0100,lon:121.3280},
  "æ˜¥æ—¥é‡Œ":{lat:25.0110,lon:121.3300},
  "æ±´æ´²é‡Œ":{lat:25.0120,lon:121.3320},
  "æ±é–€é‡Œ":{lat:25.0130,lon:121.3340},
  "æ±å±±é‡Œ":{lat:25.0140,lon:121.3360},
  "è¬å£½é‡Œ":{lat:25.0150,lon:121.3380}
};

function getUrl(city){
  const coords = cityCoords[city] || cityCoords["æœé™½é‡Œ"];
  return `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current_weather=true&hourly=temperature_2m,apparent_temperature,precipitation,precipitation_probability,relative_humidity_2m,uv_index&timezone=Asia/Taipei`;
}

function uvLevel(index){
  if(index<3) return "ä½";
  if(index<6) return "ä¸­";
  if(index<8) return "é«˜";
  if(index<11) return "å¾ˆé«˜";
  return "å±éšª";
}

function updateTimeText() {
  const now = new Date();
  const y = now.getFullYear();
  const m = (now.getMonth()+1).toString().padStart(2,'0');
  const d = now.getDate().toString().padStart(2,'0');
  const h = now.getHours().toString().padStart(2,'0');
  const min = now.getMinutes().toString().padStart(2,'0');
  const s = now.getSeconds().toString().padStart(2,'0');
  document.getElementById("timeText").innerText=`ç•¶å‰æ™‚é–“ï¼š${y}-${m}-${d} ${h}:${min}:${s}`;
}

function getBackgroundColor(cw, precipitation, todayMax){
  const hour = new Date().getHours();
  const isNight = hour<6 || hour>=18;
  if(precipitation > 0) return "linear-gradient(to bottom,#4a90e2,#50a7f9)";
  if(isNight) return "linear-gradient(to bottom,#0d1b2a,#1b263b)";
  if(todayMax >= 30) return "linear-gradient(to bottom,#ff7e5f,#feb47b)";
  if(todayMax >= 25) return "linear-gradient(to bottom,#fbc2eb,#a6c1ee)";
  return "linear-gradient(to bottom,#0f2027,#203a43,#2c5364)";
}

function fetchWeather(){
  const weatherDiv = document.getElementById("weather");
  const hourlyDiv = document.getElementById("hourly-weather");
  const dailyDiv = document.getElementById("daily-temp");
  weatherDiv.style.opacity = 0;
  hourlyDiv.innerHTML = "è®€å–ä¸­...";
  dailyDiv.innerHTML = "";

  fetch(getUrl(currentCity))
    .then(res => { if(!res.ok) throw new Error("ç„¡æ³•å–å¾—å¤©æ°£è³‡æ–™"); return res.json(); })
    .then(data => {
      const cw = data.current_weather;
      const h = data.hourly;
      const now = new Date();
      let closestIndex = 0, minDiff = Infinity;

      h.time.forEach((t,i)=>{
        const diff=Math.abs(new Date(t).getTime()-now.getTime());
        if(diff<minDiff){ minDiff=diff; closestIndex=i; }
      });

      const todayDate = now.toISOString().slice(0,10);
      const todayTemps = h.temperature_2m.filter((_,i)=> h.time[i].startsWith(todayDate));
      const todayMax = Math.max(...todayTemps);
      const todayMin = Math.min(...todayTemps);

      const precipitation = h.precipitation[closestIndex];
      const precipitationProb = h.precipitation_probability ? h.precipitation_probability[closestIndex] : 'N/A';
      const humidity = h.relative_humidity_2m[closestIndex];
      const apparentTemp = h.apparent_temperature[closestIndex];
      const uvIndex = h.uv_index[closestIndex];
      const uvText = uvLevel(uvIndex);

      let rainNotice = "";
      if(precipitation > 0) rainNotice = "<br>ğŸŒ‚ æ³¨æ„ï¼šä»Šå¤©æœƒä¸‹é›¨ï¼Œè¨˜å¾—å¸¶å‚˜ï¼";

      weatherDiv.innerHTML=`
        ğŸŒ¡ï¸ æº«åº¦ï¼š${cw.temperature}Â°C <br>
        ğŸ¥µ é«”æ„Ÿæº«åº¦ï¼š${apparentTemp}Â°C <br>
        ğŸ’¨ é¢¨é€Ÿï¼š${cw.windspeed} m/s <br>
        ğŸŒ¬ï¸ é¢¨å‘ï¼š${cw.winddirection}Â° <br>
        ğŸŒ§ï¸ é™é›¨é‡ï¼š${precipitation} mm <br>
        â˜” é™é›¨æ©Ÿç‡ï¼š${precipitationProb}% <br>
        ğŸ’§ æ¿•åº¦ï¼š${humidity}% <br>
        ğŸŒ ç´«å¤–ç·šï¼š${uvIndex} (${uvText})
        ${rainNotice}
      `;

      // æ¯å°æ™‚å¤©æ°£å®Œæ•´è¡¨æ ¼ï¼ˆä»Šå¤© 0~23 æ™‚ï¼‰
      let htmlHourly = "";
      for(let i=0; i<h.time.length; i++){
        if(!h.time[i].startsWith(todayDate)) continue;
        const date = new Date(h.time[i]);
        const hour = date.getHours();
        const temp = h.temperature_2m[i];
        const precipHour = h.precipitation[i];

        let icon = "â˜ï¸";
        if(precipHour>0) icon="ğŸŒ§ï¸";
        else if(temp>30) icon="ğŸŒ";
        else if(temp<20) icon="â„ï¸";

        htmlHourly += `
          <div class="hour-cell">
            <div>${hour}:00</div>
            <div class="icon">${icon}</div>
            <div>${temp}Â°C</div>
          </div>
        `;
      }
      hourlyDiv.innerHTML = htmlHourly;
      dailyDiv.innerHTML = `ğŸ”º æœ€é«˜ï¼š${todayMax}Â°C &nbsp;&nbsp; ğŸ”» æœ€ä½ï¼š${todayMin}Â°C`;

      document.body.style.background = getBackgroundColor(cw, precipitation, todayMax);
      setTimeout(()=>{ weatherDiv.style.opacity = 1; },50);
    })
    .catch(err=>{
      weatherDiv.innerHTML=`<span style="color:#ff6b6b">éŒ¯èª¤ï¼š${err.message}</span>`;
      hourlyDiv.innerHTML = "";
      dailyDiv.innerHTML = "";
      weatherDiv.style.opacity = 1;
    });
}

function changeCity(){
  currentCity = document.getElementById("citySelect").value;
  fetchWeather();
}

function randomCity(){
  const cities = Object.keys(cityCoords);
  const randomIndex = Math.floor(Math.random() * cities.length);
  currentCity = cities[randomIndex];
  document.getElementById("citySelect").value = currentCity;
  fetchWeather();
}

setInterval(updateTimeText,1000);
fetchWeather();
setInterval(fetchWeather,5000);
</script>
</body>
</html>
